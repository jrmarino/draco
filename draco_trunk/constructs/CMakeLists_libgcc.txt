# This is the cmake script for libgcc_draco.a


# We need a static version of the libgcc library, and we don't need the "intrinsic"
# math functions.  GCC builds each function separately as an object file rather
# monolithicly.  This avoids function overloading and other issues, but makes
# the library build a lot more complicated.  Luckily we can just comment all these
# functions out (which can be manually requested via macro definition) and just
# not worry about them.


set (libgcc_definitions_list
#   -DL_negdi2
#   -DL_udiv_w_sdiv
#   -DL_addvsi3
#   -DL_addvdi3
#   -DL_subvsi3
#   -DL_subvdi3
#   -DL_mulvsi3
#   -DL_negvsi2
#   -DL_negvdi2
#   -DL_absvsi2
#   -DL_absvdi2
#   -DL_mulvdi3
#   -DL_lshrdi3
#   -DL_ashldi3
#   -DL_ashrdi3
#   -DL_bswapsi2
#   -DL_bswapdi2
#   -DL_ffssi2
#   -DL_ffsdi2
#   -DL_muldi3
#   -DL_divdi3
#   -DL_moddi3
#   -DL_udivdi3
#   -DL_umoddi3
#   -DL_clz
#   -DL_clzsi2
#   -DL_clzdi2
#   -DL_ctzsi2
#   -DL_ctzdi2
#   -DL_popcount_tab
#   -DL_popcountsi2
#   -DL_popcountdi2
#   -DL_paritysi2
#   -DL_paritydi2
#   -DL_cmpdi2
#   -DL_ucmpdi2
#   -DL_fixunstfdi
#   -DL_fixtfdi
#   -DL_fixunsxfdi
#   -DL_fixxfdi
#   -DL_fixunsdfdi
#   -DL_fixdfdi
#   -DL_fixunssfdi
#   -DL_fixsfdi
#   -DL_floatdixf
#   -DL_floatundixf
#   -DL_floatditf
#   -DL_floatunditf
#   -DL_floatdisf
#   -DL_floatdidf
#   -DL_floatundisf
#   -DL_floatundidf
#   -DL_fixunsxfsi
#   -DL_fixunsdfsi
#   -DL_fixunssfsi
#   -DL_powisf2
#   -DL_powidf2
#   -DL_powixf2
#   -DL_powitf2
#   -DL_mulsc3
#   -DL_muldc3
#   -DL_mulxc3
#   -DL_multc3
#   -DL_divsc3
#   -DL_divdc3
#   -DL_divxc3
#   -DL_divtc3


   -DL__gcc_bcmp
   -DL_eprintf
   -DL_clear_cache
   -DL_enable_execute_stack
   -DL_trampoline
   -DL__main
   -DL_ctors
)




# Tell CMAKE where to build the library
set (LIBRARY_OUTPUT_PATH ${DIR_C_OBJS}/libgcc)


set (libgcc_compilation_flags
   -g
   -O2
   -W
   -Wall
   -Wwrite-strings
   -Wcast-qual
   -Wstrict-prototypes
   -Wmissing-prototypes
   -Wold-style-definition
   -fPIC
   -pthread
   -DHAVE_GTHR_DEFAULT
   -DIN_GCC
   -DIN_LIBGCC2
   -D__GCC_FLOAT_NOT_NEEDED
   -DHAVE_CC_TLS
   -fexceptions
   -fnon-call-exceptions
   -fvisibility=hidden
   -DHIDE_EXPORTS
)

# change gthr-gnat.c to gthr-posix.c
set (libgcc_source_files
   ${DIR_REMNANTS}/gcc/libgcc2.c
   ${DIR_REMNANTS}/gcc/unwind-dw2.c
   ${DIR_REMNANTS}/gcc/unwind-dw2-fde.c
   ${DIR_REMNANTS}/gcc/unwind-sjlj.c
   ${DIR_REMNANTS}/gcc/unwind-c.c
   ${DIR_REMNANTS}/gcc/gthr-gnat.c
   ${DIR_REMNANTS}/gcc/emutls.c
)


add_definitions (${libgcc_definitions_list})
add_definitions (${libgcc_compilation_flags})

include_directories (${DIR_REMNANTS}/gcc ${DIR_REMNANTS}/include)
add_library (gcc_draco STATIC ${libgcc_source_files})

add_definitions (${libgcc_compilation_flags})
remove_definitions (${libgcc_definitions_list})


































